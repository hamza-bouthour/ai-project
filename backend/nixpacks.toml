[phases.setup]
nixPkgs = [
  "nodejs_20",
  "python311",
  "python311Packages.numpy",
  "python311Packages.pandas",
  "python311Packages.scikit-learn",
  "python311Packages.joblib"
]

[phases.install]
cmds = [
  "npm install"
]

[phases.build]
cmds = [
  # remove any accidental local shadowing packages in the app dir
  "rm -rf /app/numpy /app/pandas /app/sklearn /app/joblib /app/ml/numpy /app/ml/pandas /app/ml/sklearn /app/ml/joblib || true",
  "cd ml && python3 train.py"
]

[start]
cmd = "node server.js"
